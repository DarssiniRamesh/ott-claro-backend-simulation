{"is_source_file": true, "format": "JavaScript", "description": "User controller functions for user management operations, including registration, login, profile updates, and token management.", "external_files": ["../models/user.model", "../middleware/error.middleware", "../utils/sanitize.util", "../utils/password.util", "../config/env.config"], "external_methods": ["User.findOne", "User.findById", "User.save", "User.generateAuthTokens", "user.getPublicProfile", "user.comparePassword", "jwt.verify", "sanitizeInput", "validatePasswordStrength"], "published": ["startHeaderInfo", "registerUser", "loginUser", "refreshToken", "getCurrentUser", "updateProfile", "changePassword", "logoutUser", "getStartHeaderInfo"], "classes": [], "methods": [{"name": "startHeaderInfo", "description": "Initializes user session with device and region information."}, {"name": "registerUser", "description": "Handles user registration after validating input."}, {"name": "loginUser", "description": "Authenticates user and returns tokens."}, {"name": "refreshToken", "description": "Refreshes access token using a valid refresh token."}, {"name": "getCurrentUser", "description": "Retrieves the profile of the currently authenticated user."}, {"name": "updateProfile", "description": "Updates user profile information."}, {"name": "changePassword", "description": "Changes user's password after validating the current password."}, {"name": "logoutUser", "description": "Logs out the user by invalidating the refresh token."}, {"name": "getStartHeaderInfo", "description": "Gets user header information at the start of a session."}], "calls": ["sanitizeInput", "User.findOne", "User.findById", "User.save", "user.generateAuthTokens", "jwt.verify"], "search-terms": ["user controller", "user management", "auth operations", "header info", "registration", "login"], "state": 2, "file_id": 25, "knowledge_revision": 72, "git_revision": "2cb169f9e2d93f32b9565d978da820de2c0cfe41", "revision_history": [{"37": ""}, {"62": "2220229067494bf1da6586e824d7b9f797e09192"}, {"6": ""}, {"17": ""}, {"18": ""}, {"72": "2cb169f9e2d93f32b9565d978da820de2c0cfe41"}], "ctags": [{"_type": "tag", "name": "User", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const User = require('..\\/models\\/user.model');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "avatar", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      avatar: req.user.avatar || 'https:\\/\\/example.com\\/default-avatar.png',$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "avatar", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      avatar: user.profile.avatar,$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "changePassword", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const changePassword = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const config = require('..\\/config\\/env.config');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "decoded", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    let decoded;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "displayName", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      displayName: `${user.profile.firstName} ${user.profile.lastName}`.trim(),$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "displayName", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      displayName: req.user.displayName || 'User',$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "emailRegex", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const emailRegex = \\/^\\\\S+@\\\\S+\\\\.\\\\S+$\\/;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "existingUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const existingUser = await User.findOne({ email });$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "getCurrentUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const getCurrentUser = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "getStartHeaderInfo", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const getStartHeaderInfo = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "headerInfo", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const headerInfo = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "isPasswordValid", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const isPasswordValid = await user.comparePassword(currentPassword);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "jwt", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const jwt = require('jsonwebtoken');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "loginUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const loginUser = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "logoutUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const logoutUser = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "notifications", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      notifications: 0,$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "notifications", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      notifications: 5, \\/\\/ Mock notification count$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "passwordValidation", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const passwordValidation = validatePasswordStrength(newPassword);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "passwordValidation", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const passwordValidation = validatePasswordStrength(password);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "refreshToken", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const refreshToken = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "region", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      region,$/", "language": "JavaScript", "kind": "field", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "registerUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const registerUser = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "startHeaderInfo", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^  startHeaderInfo,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "startHeaderInfo", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const startHeaderInfo = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "tokens", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const tokens = await user.generateAuthTokens();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "updateProfile", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const updateProfile = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = await User.findById(decoded.id).select('+refreshToken');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = await User.findById(req.user.id).select('+password');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = await User.findById(req.user.id);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = await User.findOne({ email }).select('+password');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = new User({$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "userId", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      userId: req.user.id,$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "userId", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      userId: user._id,$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}], "filename": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "hash": "bd861f285b9ae5176b511a5ddd03b34c", "format-version": 4, "code-base-name": "default", "fields": [{"name": "avatar: req.user.avatar || 'https:\\/\\/example.com\\/default-avatar.png',", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "avatar: user.profile.avatar,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "let decoded;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "displayName: `${user.profile.firstName} ${user.profile.lastName}`.trim(),", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "displayName: req.user.displayName || 'User',", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "notifications: 0,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "notifications: 5, \\/\\/ Mock notification count", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "region,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "startHeaderInfo,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "userId: req.user.id,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "userId: user._id,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}]}