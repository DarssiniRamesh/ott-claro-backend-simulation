{"is_source_file": true, "format": "JavaScript", "description": "This file contains the user controller which manages user-related operations such as registration, login, profile updates, and session handling within an Express application.", "external_files": ["../models/user.model", "../middleware/error.middleware", "../utils/password.util", "../config/env.config"], "external_methods": ["../utils/password.util.validatePasswordStrength", "../models/user.model.findOne", "../models/user.model.save", "../models/user.model.generateAuthTokens", "../models/user.model.getPublicProfile", "../models/user.model.comparePassword", "../models/user.model.findById"], "published": ["startHeaderInfo", "registerUser", "loginUser", "refreshToken", "getCurrentUser", "updateProfile", "changePassword", "logoutUser", "getStartHeaderInfo"], "classes": [], "methods": [{"name": "startHeaderInfo", "description": "Initializes user session with device and region information.", "params": ["req", "res", "next"]}, {"name": "registerUser", "description": "Handles user registration and validates input data.", "params": ["req", "res", "next"]}, {"name": "loginUser", "description": "Logs in a user by validating credentials and generating tokens.", "params": ["req", "res", "next"]}, {"name": "refreshToken", "description": "Refreshes access tokens using the provided refresh token.", "params": ["req", "res", "next"]}, {"name": "getCurrentUser", "description": "Retrieves the profile of the currently authenticated user.", "params": ["req", "res", "next"]}, {"name": "updateProfile", "description": "Updates the user's profile information.", "params": ["req", "res", "next"]}, {"name": "changePassword", "description": "Changes the user's password with validation.", "params": ["req", "res", "next"]}, {"name": "logoutUser", "description": "Logs out the user by invalidating their refresh token.", "params": ["req", "res", "next"]}, {"name": "getStartHeaderInfo", "description": "Retrieves the user's header information including device and region data.", "params": ["req", "res", "next"]}], "calls": ["User.findOne", "User.save", "User.generateAuthTokens", "User.getPublicProfile", "User.comparePassword", "User.findById"], "search-terms": ["user management", "authentication", "user profile", "session handling"], "state": 2, "file_id": 25, "knowledge_revision": 18, "git_revision": "", "revision_history": [{"37": ""}, {"62": "2220229067494bf1da6586e824d7b9f797e09192"}, {"6": ""}, {"17": ""}, {"18": ""}], "ctags": [{"_type": "tag", "name": "User", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const User = require('..\\/models\\/user.model');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "avatar", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      avatar: req.user.avatar || 'https:\\/\\/example.com\\/default-avatar.png',$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "avatar", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      avatar: user.profile.avatar,$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "changePassword", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const changePassword = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const config = require('..\\/config\\/env.config');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "decoded", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    let decoded;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "displayName", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      displayName: `${user.profile.firstName} ${user.profile.lastName}`.trim(),$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "displayName", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      displayName: req.user.displayName || 'User',$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "emailRegex", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const emailRegex = \\/^\\\\S+@\\\\S+\\\\.\\\\S+$\\/;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "existingUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const existingUser = await User.findOne({ email });$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "getCurrentUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const getCurrentUser = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "getStartHeaderInfo", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const getStartHeaderInfo = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "headerInfo", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const headerInfo = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "isPasswordValid", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const isPasswordValid = await user.comparePassword(currentPassword);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "jwt", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const jwt = require('jsonwebtoken');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "loginUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const loginUser = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "logoutUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const logoutUser = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "notifications", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      notifications: 0,$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "notifications", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      notifications: 5, \\/\\/ Mock notification count$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "passwordValidation", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const passwordValidation = validatePasswordStrength(newPassword);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "passwordValidation", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const passwordValidation = validatePasswordStrength(password);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "refreshToken", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const refreshToken = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "region", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      region,$/", "language": "JavaScript", "kind": "field", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "registerUser", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const registerUser = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "startHeaderInfo", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^  startHeaderInfo,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "startHeaderInfo", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const startHeaderInfo = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "tokens", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const tokens = await user.generateAuthTokens();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "updateProfile", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^const updateProfile = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = await User.findById(decoded.id).select('+refreshToken');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = await User.findById(req.user.id).select('+password');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = await User.findById(req.user.id);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = await User.findOne({ email }).select('+password');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^    const user = new User({$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "userId", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      userId: req.user.id,$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "userId", "path": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "pattern": "/^      userId: user._id,$/", "language": "JavaScript", "kind": "property", "scope": "headerInfo", "scopeKind": "class"}], "filename": "/home/kavia/workspace/ott-claro-backend-simulation/src/controllers/user.controller.js", "hash": "87f5265b2711cd8ddbcdb1d3500c0642", "format-version": 4, "code-base-name": "default", "fields": [{"name": "avatar: req.user.avatar || 'https:\\/\\/example.com\\/default-avatar.png',", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "avatar: user.profile.avatar,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "let decoded;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "displayName: `${user.profile.firstName} ${user.profile.lastName}`.trim(),", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "displayName: req.user.displayName || 'User',", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "notifications: 0,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "notifications: 5, \\/\\/ Mock notification count", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "region,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "startHeaderInfo,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "userId: req.user.id,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "userId: user._id,", "scope": "headerInfo", "scopeKind": "class", "description": "unavailable"}]}